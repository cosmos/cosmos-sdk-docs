"use strict";(self.webpackChunkcosmos_sdk_docs=self.webpackChunkcosmos_sdk_docs||[]).push([[8208],{3905:(e,t,n)=>{n.d(t,{Zo:()=>p,kt:()=>g});var a=n(67294);function o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){o(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function s(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var l=a.createContext({}),m=function(e){var t=a.useContext(l),n=t;return e&&(n="function"==typeof e?e(t):r(r({},t),e)),n},p=function(e){var t=m(e.components);return a.createElement(l.Provider,{value:t},e.children)},d="mdxType",u={inlineCode:"code",wrapper:function(e){var t=e.children;return a.createElement(a.Fragment,{},t)}},c=a.forwardRef((function(e,t){var n=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),d=m(n),c=o,g=d["".concat(l,".").concat(c)]||d[c]||u[c]||i;return n?a.createElement(g,r(r({ref:t},p),{},{components:n})):a.createElement(g,r({ref:t},p))}));function g(e,t){var n=arguments,o=t&&t.mdxType;if("string"==typeof e||o){var i=n.length,r=new Array(i);r[0]=c;var s={};for(var l in t)hasOwnProperty.call(t,l)&&(s[l]=t[l]);s.originalType=e,s[d]="string"==typeof e?e:o,r[1]=s;for(var m=2;m<i;m++)r[m]=n[m];return a.createElement.apply(null,r)}return a.createElement.apply(null,n)}c.displayName="MDXCreateElement"},37630:(e,t,n)=>{n.r(t),n.d(t,{assets:()=>l,contentTitle:()=>r,default:()=>u,frontMatter:()=>i,metadata:()=>s,toc:()=>m});var a=n(87462),o=(n(67294),n(3905));const i={sidebar_position:1},r="AutoCLI",s={unversionedId:"learn/advanced/autocli",id:"learn/advanced/autocli",title:"AutoCLI",description:"This document details how to build CLI and REST interfaces for a module. Examples from various Cosmos SDK modules are included.",source:"@site/docs/learn/advanced/17-autocli.md",sourceDirName:"learn/advanced",slug:"/learn/advanced/autocli",permalink:"/main/learn/advanced/autocli",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"learnSidebar",previous:{title:"Configuration",permalink:"/main/learn/advanced/config"}},l={},m=[{value:"Overview",id:"overview",level:2},{value:"Application Wiring",id:"application-wiring",level:2},{value:"Keyring",id:"keyring",level:3},{value:"Signing",id:"signing",level:2},{value:"Module wiring &amp; Customization",id:"module-wiring--customization",level:2},{value:"Specifying Subcommands",id:"specifying-subcommands",level:3},{value:"Positional Arguments",id:"positional-arguments",level:3},{value:"Flattened Fields in Positional Arguments",id:"flattened-fields-in-positional-arguments",level:4},{value:"Customising Flag Names",id:"customising-flag-names",level:4},{value:"Combining AutoCLI with Other Commands Within A Module",id:"combining-autocli-with-other-commands-within-a-module",level:3},{value:"Skip a command",id:"skip-a-command",level:3},{value:"Use AutoCLI for non module commands",id:"use-autocli-for-non-module-commands",level:3},{value:"Summary",id:"summary",level:2}],p={toc:m},d="wrapper";function u(e){let{components:t,...n}=e;return(0,o.kt)(d,(0,a.Z)({},p,n,{components:t,mdxType:"MDXLayout"}),(0,o.kt)("h1",{id:"autocli"},"AutoCLI"),(0,o.kt)("admonition",{title:"Synopsis",type:"note"},(0,o.kt)("p",{parentName:"admonition"},"This document details how to build CLI and REST interfaces for a module. Examples from various Cosmos SDK modules are included.")),(0,o.kt)("admonition",{title:"Pre-requisite Readings",type:"note"},(0,o.kt)("ul",{parentName:"admonition"},(0,o.kt)("li",{parentName:"ul"},(0,o.kt)("a",{parentName:"li",href:"https://docs.cosmos.network/main/core/cli"},"CLI")))),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"autocli")," (also known as ",(0,o.kt)("inlineCode",{parentName:"p"},"client/v2"),") package is a ",(0,o.kt)("a",{parentName:"p",href:"https://pkg.go.dev/cosmossdk.io/client/v2/autocli"},"Go library")," for generating CLI (command line interface) interfaces for Cosmos SDK-based applications. It provides a simple way to add CLI commands to your application by generating them automatically based on your gRPC service definitions. Autocli generates CLI commands and flags directly from your protobuf messages, including options, input parameters, and output parameters. This means that you can easily add a CLI interface to your application without having to manually create and manage commands."),(0,o.kt)("h2",{id:"overview"},"Overview"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"autocli")," generates CLI commands and flags for each method defined in your gRPC service. By default, it generates commands for each gRPC services. The commands are named based on the name of the service method."),(0,o.kt)("p",null,"For example, given the following protobuf definition for a service:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-protobuf"},"service MyService {\n  rpc MyMethod(MyRequest) returns (MyResponse) {}\n}\n")),(0,o.kt)("p",null,"For instance, ",(0,o.kt)("inlineCode",{parentName:"p"},"autocli")," would generate a command named ",(0,o.kt)("inlineCode",{parentName:"p"},"my-method")," for the ",(0,o.kt)("inlineCode",{parentName:"p"},"MyMethod")," method. The command will have flags for each field in the ",(0,o.kt)("inlineCode",{parentName:"p"},"MyRequest")," message."),(0,o.kt)("p",null,"It is possible to customize the generation of transactions and queries by defining options for each service."),(0,o.kt)("h2",{id:"application-wiring"},"Application Wiring"),(0,o.kt)("p",null,"Here are the steps to use AutoCLI:"),(0,o.kt)("ol",null,(0,o.kt)("li",{parentName:"ol"},"Ensure your app's modules implements the ",(0,o.kt)("inlineCode",{parentName:"li"},"appmodule.AppModule")," interface."),(0,o.kt)("li",{parentName:"ol"},"(optional) Configure how behave ",(0,o.kt)("inlineCode",{parentName:"li"},"autocli")," command generation, by implementing the ",(0,o.kt)("inlineCode",{parentName:"li"},"func (am AppModule) AutoCLIOptions() *autocliv1.ModuleOptions")," method on the module."),(0,o.kt)("li",{parentName:"ol"},"Use the ",(0,o.kt)("inlineCode",{parentName:"li"},"autocli.AppOptions")," struct to specify the modules you defined. If you are using ",(0,o.kt)("inlineCode",{parentName:"li"},"depinject"),", it can automatically create an instance of ",(0,o.kt)("inlineCode",{parentName:"li"},"autocli.AppOptions")," based on your app's configuration."),(0,o.kt)("li",{parentName:"ol"},"Use the ",(0,o.kt)("inlineCode",{parentName:"li"},"EnhanceRootCommand()")," method provided by ",(0,o.kt)("inlineCode",{parentName:"li"},"autocli")," to add the CLI commands for the specified modules to your root command.")),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"AutoCLI is additive only, meaning ",(0,o.kt)("em",{parentName:"p"},"enhancing")," the root command will only add subcommands that are not already registered. This means that you can use AutoCLI alongside other custom commands within your app.")),(0,o.kt)("p",null,"Here's an example of how to use ",(0,o.kt)("inlineCode",{parentName:"p"},"autocli")," in your app:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},'// Define your app\'s modules\ntestModules := map[string]appmodule.AppModule{\n    "testModule": &TestModule{},\n}\n\n// Define the autocli AppOptions\nautoCliOpts := autocli.AppOptions{\n    Modules: testModules,\n}\n\n// Create the root command\nrootCmd := &cobra.Command{\n    Use: "app",\n}\n\nif err := appOptions.EnhanceRootCommand(rootCmd); err != nil {\n    return err\n}\n\n// Run the root command\nif err := rootCmd.Execute(); err != nil {\n    return err\n}\n')),(0,o.kt)("h3",{id:"keyring"},"Keyring"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"autocli")," uses a keyring for key name resolving names and signing transactions."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"AutoCLI provides a better UX than normal CLI as it allows to resolve key names directly from the keyring in all transactions and commands."),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-sh"},"<appd> q bank balances alice\n<appd> tx bank send alice bob 1000denom\n"))),(0,o.kt)("p",null,"The keyring used for resolving names and signing transactions is provided via the ",(0,o.kt)("inlineCode",{parentName:"p"},"client.Context"),".\nThe keyring is then converted to the ",(0,o.kt)("inlineCode",{parentName:"p"},"client/v2/autocli/keyring")," interface.\nIf no keyring is provided, the ",(0,o.kt)("inlineCode",{parentName:"p"},"autocli")," generated command will not be able to sign transactions, but will still be able to query the chain."),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"The Cosmos SDK keyring implements the ",(0,o.kt)("inlineCode",{parentName:"p"},"client/v2/autocli/keyring")," interface, thanks to the following wrapper:"),(0,o.kt)("pre",{parentName:"admonition"},(0,o.kt)("code",{parentName:"pre",className:"language-go"},"keyring.NewAutoCLIKeyring(kb)\n"))),(0,o.kt)("h2",{id:"signing"},"Signing"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"autocli")," supports signing transactions with the keyring.\nThe ",(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/main/build/building-modules/protobuf-annotations"},(0,o.kt)("inlineCode",{parentName:"a"},"cosmos.msg.v1.signer")," protobuf annotation")," defines the signer field of the message.\nThis field is automatically filled when using the ",(0,o.kt)("inlineCode",{parentName:"p"},"--from")," flag or defining the signer as a positional argument."),(0,o.kt)("admonition",{type:"warning"},(0,o.kt)("p",{parentName:"admonition"},"AutoCLI currently supports only one signer per transaction.")),(0,o.kt)("h2",{id:"module-wiring--customization"},"Module wiring & Customization"),(0,o.kt)("p",null,"The ",(0,o.kt)("inlineCode",{parentName:"p"},"AutoCLIOptions()")," method on your module allows to specify custom commands, sub-commands or flags for each service, as it was a ",(0,o.kt)("inlineCode",{parentName:"p"},"cobra.Command")," instance, within the ",(0,o.kt)("inlineCode",{parentName:"p"},"RpcCommandOptions")," struct. Defining such options will customize the behavior of the ",(0,o.kt)("inlineCode",{parentName:"p"},"autocli")," command generation, which by default generates a command for each method in your gRPC service."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},'*autocliv1.RpcCommandOptions{\n  RpcMethod: "Params", // The name of the gRPC service\n  Use:       "params", // Command usage that is displayed in the help\n  Short:     "Query the parameters of the governance process", // Short description of the command\n  Long:      "Query the parameters of the governance process. Specify specific param types (voting|tallying|deposit) to filter results.", // Long description of the command\n  PositionalArgs: []*autocliv1.PositionalArgDescriptor{\n    {ProtoField: "params_type", Optional: true}, // Transform a flag into a positional argument\n  },\n}\n')),(0,o.kt)("admonition",{type:"tip"},(0,o.kt)("p",{parentName:"admonition"},"AutoCLI can create a gov proposal of any tx by simply setting the ",(0,o.kt)("inlineCode",{parentName:"p"},"GovProposal")," field to ",(0,o.kt)("inlineCode",{parentName:"p"},"true")," in the ",(0,o.kt)("inlineCode",{parentName:"p"},"autocli.RpcCommandOptions")," struct.\nUsers can however use the ",(0,o.kt)("inlineCode",{parentName:"p"},"--no-proposal")," flag to disable the proposal creation (which is useful if the authority isn't the gov module on a chain).")),(0,o.kt)("h3",{id:"specifying-subcommands"},"Specifying Subcommands"),(0,o.kt)("p",null,"By default, ",(0,o.kt)("inlineCode",{parentName:"p"},"autocli")," generates a command for each method in your gRPC service. However, you can specify subcommands to group related commands together. To specify subcommands, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"autocliv1.ServiceCommandDescriptor")," struct."),(0,o.kt)("p",null,"This example shows how to use the ",(0,o.kt)("inlineCode",{parentName:"p"},"autocliv1.ServiceCommandDescriptor")," struct to group related commands together and specify subcommands in your gRPC service by defining an instance of ",(0,o.kt)("inlineCode",{parentName:"p"},"autocliv1.ModuleOptions")," in your ",(0,o.kt)("inlineCode",{parentName:"p"},"autocli.go"),"."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-beta.0/x/gov/autocli.go#L94-L97\n")),(0,o.kt)("h3",{id:"positional-arguments"},"Positional Arguments"),(0,o.kt)("p",null,"By default ",(0,o.kt)("inlineCode",{parentName:"p"},"autocli")," generates a flag for each field in your protobuf message. However, you can choose to use positional arguments instead of flags for certain fields."),(0,o.kt)("p",null,"To add positional arguments to a command, use the ",(0,o.kt)("inlineCode",{parentName:"p"},"autocliv1.PositionalArgDescriptor")," struct, as seen in the example below. Specify the ",(0,o.kt)("inlineCode",{parentName:"p"},"ProtoField")," parameter, which is the name of the protobuf field that should be used as the positional argument. In addition, if the parameter is a variable-length argument, you can specify the ",(0,o.kt)("inlineCode",{parentName:"p"},"Varargs")," parameter as ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),". This can only be applied to the last positional parameter, and the ",(0,o.kt)("inlineCode",{parentName:"p"},"ProtoField")," must be a repeated field."),(0,o.kt)("p",null,"Here's an example of how to define a positional argument for the ",(0,o.kt)("inlineCode",{parentName:"p"},"Account")," method of the ",(0,o.kt)("inlineCode",{parentName:"p"},"auth")," service:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/v0.50.0-beta.0/x/auth/autocli.go#L25-L30\n")),(0,o.kt)("p",null,"Then the command can be used as follows, instead of having to specify the ",(0,o.kt)("inlineCode",{parentName:"p"},"--address")," flag:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},"<appd> query auth account cosmos1abcd...xyz\n")),(0,o.kt)("h4",{id:"flattened-fields-in-positional-arguments"},"Flattened Fields in Positional Arguments"),(0,o.kt)("p",null,"AutoCLI also supports flattening nested message fields as positional arguments. This means you can access nested fields\nusing dot notation in the ",(0,o.kt)("inlineCode",{parentName:"p"},"ProtoField")," parameter. This is particularly useful when you want to directly set nested\nmessage fields as positional arguments."),(0,o.kt)("p",null,"For example, if you have a nested message structure like this:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-protobuf"},"message Permissions {\n    string level = 1;\n    repeated string limit_type_urls = 2;\n}\n\nmessage MsgAuthorizeCircuitBreaker {\n    string grantee = 1;\n    Permissions permissions = 2;\n}\n")),(0,o.kt)("p",null,"You can flatten the fields in your AutoCLI configuration:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},'{\n    RpcMethod: "AuthorizeCircuitBreaker",\n    Use:       "authorize <grantee> <level> <msg_type_urls>",\n    PositionalArgs: []*autocliv1.PositionalArgDescriptor{\n        {ProtoField: "grantee"},\n        {ProtoField: "permissions.level"},\n        {ProtoField: "permissions.limit_type_urls"},\n    },\n}\n')),(0,o.kt)("p",null,"This allows users to provide values for nested fields directly as positional arguments:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-bash"},'<appd> tx circuit authorize cosmos1... super-admin "/cosmos.bank.v1beta1.MsgSend,/cosmos.bank.v1beta1.MsgMultiSend"\n')),(0,o.kt)("p",null,"Instead of having to provide a complex JSON structure for nested fields, flattening makes the CLI more user-friendly by allowing direct access to nested fields."),(0,o.kt)("h4",{id:"customising-flag-names"},"Customising Flag Names"),(0,o.kt)("p",null,"By default, ",(0,o.kt)("inlineCode",{parentName:"p"},"autocli")," generates flag names based on the names of the fields in your protobuf message. However, you can customise the flag names by providing a ",(0,o.kt)("inlineCode",{parentName:"p"},"FlagOptions"),". This parameter allows you to specify custom names for flags based on the names of the message fields."),(0,o.kt)("p",null,"For example, if you have a message with the fields ",(0,o.kt)("inlineCode",{parentName:"p"},"test")," and ",(0,o.kt)("inlineCode",{parentName:"p"},"test1"),", you can use the following naming options to customise the flags:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},'autocliv1.RpcCommandOptions{ \n    FlagOptions: map[string]*autocliv1.FlagOptions{ \n        "test": { Name: "custom_name", }, \n        "test1": { Name: "other_name", }, \n    }, \n}\n')),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"FlagsOptions")," is defined like sub commands in the ",(0,o.kt)("inlineCode",{parentName:"p"},"AutoCLIOptions()")," method on your module."),(0,o.kt)("h3",{id:"combining-autocli-with-other-commands-within-a-module"},"Combining AutoCLI with Other Commands Within A Module"),(0,o.kt)("p",null,"AutoCLI can be used alongside other commands within a module. For example, the ",(0,o.kt)("inlineCode",{parentName:"p"},"gov")," module uses AutoCLI to generate commands for the ",(0,o.kt)("inlineCode",{parentName:"p"},"query")," subcommand, but also defines custom commands for the ",(0,o.kt)("inlineCode",{parentName:"p"},"proposer")," subcommands."),(0,o.kt)("p",null,"In order to enable this behavior, set in ",(0,o.kt)("inlineCode",{parentName:"p"},"AutoCLIOptions()")," the ",(0,o.kt)("inlineCode",{parentName:"p"},"EnhanceCustomCommand")," field to ",(0,o.kt)("inlineCode",{parentName:"p"},"true"),", for the command type (queries and/or transactions) you want to enhance."),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/fa4d87ef7e6d87aaccc94c337ffd2fe90fcb7a9d/x/gov/autocli.go#L98\n")),(0,o.kt)("p",null,"If not set to true, ",(0,o.kt)("inlineCode",{parentName:"p"},"AutoCLI")," will not generate commands for the module if there are already commands registered for the module (when ",(0,o.kt)("inlineCode",{parentName:"p"},"GetTxCmd()")," or ",(0,o.kt)("inlineCode",{parentName:"p"},"GetTxCmd()")," are defined)."),(0,o.kt)("h3",{id:"skip-a-command"},"Skip a command"),(0,o.kt)("p",null,"AutoCLI automatically skips unsupported commands when ",(0,o.kt)("a",{parentName:"p",href:"https://docs.cosmos.network/main/build/building-modules/protobuf-annotations"},(0,o.kt)("inlineCode",{parentName:"a"},"cosmos_proto.method_added_in")," protobuf annotation")," is present."),(0,o.kt)("p",null,"Additionally, a command can be manually skipped using the ",(0,o.kt)("inlineCode",{parentName:"p"},"autocliv1.RpcCommandOptions"),":"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go"},'*autocliv1.RpcCommandOptions{\n  RpcMethod: "Params", // The name of the gRPC service\n  Skip: true,\n}\n')),(0,o.kt)("h3",{id:"use-autocli-for-non-module-commands"},"Use AutoCLI for non module commands"),(0,o.kt)("p",null,"It is possible to use ",(0,o.kt)("inlineCode",{parentName:"p"},"AutoCLI")," for non module commands. The trick is still to implement the ",(0,o.kt)("inlineCode",{parentName:"p"},"appmodule.Module")," interface and append it to the ",(0,o.kt)("inlineCode",{parentName:"p"},"appOptions.ModuleOptions")," map."),(0,o.kt)("p",null,"For example, here is how the SDK does it for ",(0,o.kt)("inlineCode",{parentName:"p"},"cometbft")," gRPC commands:"),(0,o.kt)("pre",null,(0,o.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/client/v2.0.0-beta.1/client/grpc/cmtservice/autocli.go#L52-L71\n")),(0,o.kt)("h2",{id:"summary"},"Summary"),(0,o.kt)("p",null,(0,o.kt)("inlineCode",{parentName:"p"},"autocli")," lets you generate CLI for your Cosmos SDK-based applications without any cobra boilerplate. It allows you to easily generate CLI commands and flags from your protobuf messages, and provides many options for customising the behavior of your CLI application."))}u.isMDXComponent=!0}}]);