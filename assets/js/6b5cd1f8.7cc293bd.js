"use strict";(self.webpackChunkcosmos_sdk_docs=self.webpackChunkcosmos_sdk_docs||[]).push([[81993],{3905:(e,o,t)=>{t.d(o,{Zo:()=>c,kt:()=>f});var n=t(67294);function r(e,o,t){return o in e?Object.defineProperty(e,o,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[o]=t,e}function i(e,o){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);o&&(n=n.filter((function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable}))),t.push.apply(t,n)}return t}function l(e){for(var o=1;o<arguments.length;o++){var t=null!=arguments[o]?arguments[o]:{};o%2?i(Object(t),!0).forEach((function(o){r(e,o,t[o])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(o){Object.defineProperty(e,o,Object.getOwnPropertyDescriptor(t,o))}))}return e}function a(e,o){if(null==e)return{};var t,n,r=function(e,o){if(null==e)return{};var t,n,r={},i=Object.keys(e);for(n=0;n<i.length;n++)t=i[n],o.indexOf(t)>=0||(r[t]=e[t]);return r}(e,o);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(n=0;n<i.length;n++)t=i[n],o.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(r[t]=e[t])}return r}var s=n.createContext({}),u=function(e){var o=n.useContext(s),t=o;return e&&(t="function"==typeof e?e(o):l(l({},o),e)),t},c=function(e){var o=u(e.components);return n.createElement(s.Provider,{value:o},e.children)},p="mdxType",d={inlineCode:"code",wrapper:function(e){var o=e.children;return n.createElement(n.Fragment,{},o)}},m=n.forwardRef((function(e,o){var t=e.components,r=e.mdxType,i=e.originalType,s=e.parentName,c=a(e,["components","mdxType","originalType","parentName"]),p=u(t),m=r,f=p["".concat(s,".").concat(m)]||p[m]||d[m]||i;return t?n.createElement(f,l(l({ref:o},c),{},{components:t})):n.createElement(f,l({ref:o},c))}));function f(e,o){var t=arguments,r=o&&o.mdxType;if("string"==typeof e||r){var i=t.length,l=new Array(i);l[0]=m;var a={};for(var s in o)hasOwnProperty.call(o,s)&&(a[s]=o[s]);a.originalType=e,a[p]="string"==typeof e?e:r,l[1]=a;for(var u=2;u<i;u++)l[u]=t[u];return n.createElement.apply(null,l)}return n.createElement.apply(null,t)}m.displayName="MDXCreateElement"},43293:(e,o,t)=>{t.r(o),t.d(o,{assets:()=>s,contentTitle:()=>l,default:()=>d,frontMatter:()=>i,metadata:()=>a,toc:()=>u});var n=t(87462),r=(t(67294),t(3905));const i={sidebar_position:1},l="x/protocolpool",a={unversionedId:"build/modules/protocolpool/README",id:"build/modules/protocolpool/README",title:"x/protocolpool",description:"Concepts",source:"@site/docs/build/modules/protocolpool/README.md",sourceDirName:"build/modules/protocolpool",slug:"/build/modules/protocolpool/",permalink:"/main/build/modules/protocolpool/",draft:!1,tags:[],version:"current",sidebarPosition:1,frontMatter:{sidebar_position:1},sidebar:"buildSidebar",previous:{title:"x/params",permalink:"/main/build/modules/params/"},next:{title:"x/slashing",permalink:"/main/build/modules/slashing/"}},s={},u=[{value:"Concepts",id:"concepts",level:2},{value:"Usage Limitations",id:"usage-limitations",level:2},{value:"State Transitions",id:"state-transitions",level:2},{value:"FundCommunityPool",id:"fundcommunitypool",level:3},{value:"CommunityPoolSpend",id:"communitypoolspend",level:3},{value:"CreateContinuousFund",id:"createcontinuousfund",level:3},{value:"CancelContinuousFund",id:"cancelcontinuousfund",level:3},{value:"Messages",id:"messages",level:2},{value:"MsgFundCommunityPool",id:"msgfundcommunitypool",level:3},{value:"MsgCommunityPoolSpend",id:"msgcommunitypoolspend",level:3},{value:"MsgCreateContinuousFund",id:"msgcreatecontinuousfund",level:3},{value:"MsgCancelContinuousFund",id:"msgcancelcontinuousfund",level:3},{value:"Client",id:"client",level:2}],c={toc:u},p="wrapper";function d(e){let{components:o,...t}=e;return(0,r.kt)(p,(0,n.Z)({},c,t,{components:o,mdxType:"MDXLayout"}),(0,r.kt)("h1",{id:"xprotocolpool"},(0,r.kt)("inlineCode",{parentName:"h1"},"x/protocolpool")),(0,r.kt)("h2",{id:"concepts"},"Concepts"),(0,r.kt)("p",null,(0,r.kt)("inlineCode",{parentName:"p"},"x/protocolpool")," is a supplemental Cosmos SDK module that handles functionality for community pool funds. The module provides a separate module account for the community pool making it easier to track the pool assets. Starting with v0.53 of the Cosmos SDK, community funds can be tracked using this module instead of the ",(0,r.kt)("inlineCode",{parentName:"p"},"x/distribution")," module. Funds are migrated from the ",(0,r.kt)("inlineCode",{parentName:"p"},"x/distribution")," module's community pool to ",(0,r.kt)("inlineCode",{parentName:"p"},"x/protocolpool"),"'s module account automatically."),(0,r.kt)("p",null,"This module is ",(0,r.kt)("inlineCode",{parentName:"p"},"supplemental"),"; it is not required to run a Cosmos SDK chain. ",(0,r.kt)("inlineCode",{parentName:"p"},"x/protocolpool")," enhances the community pool functionality provided by ",(0,r.kt)("inlineCode",{parentName:"p"},"x/distribution")," and enables custom modules to further extend the community pool."),(0,r.kt)("p",null,"Note: ",(0,r.kt)("em",{parentName:"p"},"as long as an external community pool keeper (here, ",(0,r.kt)("inlineCode",{parentName:"em"},"x/protocolpool"),") is wired in DI configs, ",(0,r.kt)("inlineCode",{parentName:"em"},"x/distribution")," will automatically use it for its external pool.")),(0,r.kt)("h2",{id:"usage-limitations"},"Usage Limitations"),(0,r.kt)("p",null,"The following ",(0,r.kt)("inlineCode",{parentName:"p"},"x/distribution")," handlers will now return an error when the ",(0,r.kt)("inlineCode",{parentName:"p"},"protocolpool")," module is used with ",(0,r.kt)("inlineCode",{parentName:"p"},"x/distribution"),":"),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"QueryService")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"CommunityPool"))),(0,r.kt)("p",null,(0,r.kt)("strong",{parentName:"p"},"MsgService")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"CommunityPoolSpend")),(0,r.kt)("li",{parentName:"ul"},(0,r.kt)("inlineCode",{parentName:"li"},"FundCommunityPool"))),(0,r.kt)("p",null,"If you have services that rely on this functionality from ",(0,r.kt)("inlineCode",{parentName:"p"},"x/distribution"),", please update them to use the ",(0,r.kt)("inlineCode",{parentName:"p"},"x/protocolpool")," equivalents."),(0,r.kt)("h2",{id:"state-transitions"},"State Transitions"),(0,r.kt)("h3",{id:"fundcommunitypool"},"FundCommunityPool"),(0,r.kt)("p",null,"FundCommunityPool can be called by any valid account to send funds to the ",(0,r.kt)("inlineCode",{parentName:"p"},"x/protocolpool")," module account."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},"  // FundCommunityPool defines a method to allow an account to directly\n  // fund the community pool.\n  rpc FundCommunityPool(MsgFundCommunityPool) returns (MsgFundCommunityPoolResponse);\n")),(0,r.kt)("h3",{id:"communitypoolspend"},"CommunityPoolSpend"),(0,r.kt)("p",null,"CommunityPoolSpend can be called by the module authority (default governance module account) or any account with authorization to spend funds from the ",(0,r.kt)("inlineCode",{parentName:"p"},"x/protocolpool")," module account to a receiver address."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},"  // CommunityPoolSpend defines a governance  operation for sending tokens from\n  // the community pool in the x/protocolpool module to another account, which\n  // could be the governance module itself. The authority is defined in the\n  // keeper.\n  rpc CommunityPoolSpend(MsgCommunityPoolSpend) returns (MsgCommunityPoolSpendResponse);\n")),(0,r.kt)("h3",{id:"createcontinuousfund"},"CreateContinuousFund"),(0,r.kt)("p",null,"CreateContinuousFund is a message used to initiate a continuous fund for a specific recipient. The proposed percentage of funds will be distributed only on withdraw request for the recipient. The fund distribution continues until expiry time is reached or continuous fund request is canceled.\nNOTE:  This feature is designed to work with the SDK's default bond denom. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},"  // CreateContinuousFund defines a method to distribute a percentage of funds to an address continuously.\n  // This ContinuousFund can be indefinite or run until a given expiry time.\n  // Funds come from validator block rewards from x/distribution, but may also come from\n  // any user who funds the ProtocolPoolEscrow module account directly through x/bank.\n  rpc CreateContinuousFund(MsgCreateContinuousFund) returns (MsgCreateContinuousFundResponse);\n")),(0,r.kt)("h3",{id:"cancelcontinuousfund"},"CancelContinuousFund"),(0,r.kt)("p",null,"CancelContinuousFund is a message used to cancel an existing continuous fund proposal for a specific recipient. Cancelling a continuous fund stops further distribution of funds, and the state object is removed from storage."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf"},"  // CancelContinuousFund defines a method for cancelling continuous fund.\n  rpc CancelContinuousFund(MsgCancelContinuousFund) returns (MsgCancelContinuousFundResponse);\n")),(0,r.kt)("h2",{id:"messages"},"Messages"),(0,r.kt)("h3",{id:"msgfundcommunitypool"},"MsgFundCommunityPool"),(0,r.kt)("p",null,"This message sends coins directly from the sender to the community pool."),(0,r.kt)("admonition",{type:"tip"},(0,r.kt)("p",{parentName:"admonition"},"If you know the ",(0,r.kt)("inlineCode",{parentName:"p"},"x/protocolpool")," module account address, you can directly use bank ",(0,r.kt)("inlineCode",{parentName:"p"},"send")," transaction instead.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/release/v0.53.x/proto/cosmos/protocolpool/v1/tx.proto#L43-L53\n")),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The msg will fail if the amount cannot be transferred from the sender to the ",(0,r.kt)("inlineCode",{parentName:"li"},"x/protocolpool")," module account.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"func (k Keeper) FundCommunityPool(ctx context.Context, amount sdk.Coins, sender sdk.AccAddress) error {\n    return k.bankKeeper.SendCoinsFromAccountToModule(ctx, sender, types.ModuleName, amount)\n}\n")),(0,r.kt)("h3",{id:"msgcommunitypoolspend"},"MsgCommunityPoolSpend"),(0,r.kt)("p",null,"This message distributes funds from the ",(0,r.kt)("inlineCode",{parentName:"p"},"x/protocolpool")," module account to the recipient using ",(0,r.kt)("inlineCode",{parentName:"p"},"DistributeFromCommunityPool")," keeper method."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/release/v0.53.x/proto/cosmos/protocolpool/v1/tx.proto#L58-L69\n")),(0,r.kt)("p",null,"The message will fail under the following conditions:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The amount cannot be transferred to the recipient from the ",(0,r.kt)("inlineCode",{parentName:"li"},"x/protocolpool")," module account."),(0,r.kt)("li",{parentName:"ul"},"The ",(0,r.kt)("inlineCode",{parentName:"li"},"recipient")," address is restricted")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go"},"func (k Keeper) DistributeFromCommunityPool(ctx context.Context, amount sdk.Coins, receiveAddr sdk.AccAddress) error {\n    return k.bankKeeper.SendCoinsFromModuleToAccount(ctx, types.ModuleName, receiveAddr, amount)\n}\n")),(0,r.kt)("h3",{id:"msgcreatecontinuousfund"},"MsgCreateContinuousFund"),(0,r.kt)("p",null,"This message is used to create a continuous fund for a specific recipient. The proposed percentage of funds will be distributed only on withdraw request for the recipient. This fund distribution continues until expiry time is reached or continuous fund request is canceled."),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/release/v0.53.x/proto/cosmos/protocolpool/v1/tx.proto#L114-L130\n")),(0,r.kt)("p",null,"The message will fail under the following conditions:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The recipient address is empty or restricted."),(0,r.kt)("li",{parentName:"ul"},"The percentage is zero/negative/greater than one."),(0,r.kt)("li",{parentName:"ul"},"The Expiry time is less than the current block time.")),(0,r.kt)("admonition",{type:"warning"},(0,r.kt)("p",{parentName:"admonition"},"If two continuous fund proposals to the same address are created, the previous ContinuousFund will be updated with the new ContinuousFund.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/release/v0.53.x/x/protocolpool/keeper/msg_server.go#L103-L166\n")),(0,r.kt)("h3",{id:"msgcancelcontinuousfund"},"MsgCancelContinuousFund"),(0,r.kt)("p",null,"This message is used to cancel an existing continuous fund proposal for a specific recipient. Once canceled, the continuous fund will no longer distribute funds at each begin block, and the state object will be removed. "),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-protobuf",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/release/v0.53.x/x/protocolpool/proto/cosmos/protocolpool/v1/tx.proto#L136-L161\n")),(0,r.kt)("p",null,"The message will fail under the following conditions:"),(0,r.kt)("ul",null,(0,r.kt)("li",{parentName:"ul"},"The recipient address is empty or restricted."),(0,r.kt)("li",{parentName:"ul"},"The ContinuousFund for the recipient does not exist.")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/release/v0.53.x/x/protocolpool/keeper/msg_server.go#L188-L226\n")),(0,r.kt)("h2",{id:"client"},"Client"),(0,r.kt)("p",null,"It takes the advantage of ",(0,r.kt)("inlineCode",{parentName:"p"},"AutoCLI")),(0,r.kt)("pre",null,(0,r.kt)("code",{parentName:"pre",className:"language-go",metastring:"reference",reference:!0},"https://github.com/cosmos/cosmos-sdk/blob/release/v0.53.x/x/protocolpool/autocli.go\n")))}d.isMDXComponent=!0}}]);