"use strict";(self.webpackChunkcosmos_sdk_docs=self.webpackChunkcosmos_sdk_docs||[]).push([[36522],{3905:(e,n,t)=>{t.d(n,{Zo:()=>u,kt:()=>k});var a=t(67294);function i(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function o(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?o(Object(t),!0).forEach((function(n){i(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):o(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function l(e,n){if(null==e)return{};var t,a,i=function(e,n){if(null==e)return{};var t,a,i={},o=Object.keys(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||(i[t]=e[t]);return i}(e,n);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(a=0;a<o.length;a++)t=o[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(i[t]=e[t])}return i}var s=a.createContext({}),p=function(e){var n=a.useContext(s),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},u=function(e){var n=p(e.components);return a.createElement(s.Provider,{value:n},e.children)},d="mdxType",m={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},c=a.forwardRef((function(e,n){var t=e.components,i=e.mdxType,o=e.originalType,s=e.parentName,u=l(e,["components","mdxType","originalType","parentName"]),d=p(t),c=i,k=d["".concat(s,".").concat(c)]||d[c]||m[c]||o;return t?a.createElement(k,r(r({ref:n},u),{},{components:t})):a.createElement(k,r({ref:n},u))}));function k(e,n){var t=arguments,i=n&&n.mdxType;if("string"==typeof e||i){var o=t.length,r=new Array(o);r[0]=c;var l={};for(var s in n)hasOwnProperty.call(n,s)&&(l[s]=n[s]);l.originalType=e,l[d]="string"==typeof e?e:i,r[1]=l;for(var p=2;p<o;p++)r[p]=t[p];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}c.displayName="MDXCreateElement"},7563:(e,n,t)=>{t.r(n),t.d(n,{assets:()=>s,contentTitle:()=>r,default:()=>m,frontMatter:()=>o,metadata:()=>l,toc:()=>p});var a=t(87462),i=(t(67294),t(3905));const o={},r="Upgrade Reference",l={unversionedId:"build/migrations/upgrade-reference",id:"version-0.53/build/migrations/upgrade-reference",title:"Upgrade Reference",description:"This document provides a quick reference for the upgrades from v0.50.x to v0.53.x of Cosmos SDK.",source:"@site/versioned_docs/version-0.53/build/migrations/02-upgrade-reference.md",sourceDirName:"build/migrations",slug:"/build/migrations/upgrade-reference",permalink:"/v0.53/build/migrations/upgrade-reference",draft:!1,tags:[],version:"0.53",sidebarPosition:2,frontMatter:{},sidebar:"buildSidebar",previous:{title:"SDK Migrations",permalink:"/v0.53/build/migrations/intro"},next:{title:"Upgrade Guide",permalink:"/v0.53/build/migrations/upgrade-guide"}},s={},p=[{value:"TLDR;",id:"tldr",level:3},{value:"Unordered Transactions",id:"unordered-transactions",level:3},{value:"Enabling Unordered Transactions",id:"enabling-unordered-transactions",level:4},{value:"App Wiring Changes",id:"app-wiring-changes",level:3},{value:"New Modules",id:"new-modules",level:3},{value:"Epochs",id:"epochs",level:4},{value:"ProtocolPool",id:"protocolpool",level:4},{value:"Custom Minting Function in <code>x/mint</code>",id:"custom-minting-function-in-xmint",level:2},{value:"What\u2019s New",id:"whats-new",level:3},{value:"How to Upgrade",id:"how-to-upgrade",level:3},{value:"Misc Changes",id:"misc-changes",level:3},{value:"Testnet&#39;s init-files Command",id:"testnets-init-files-command",level:4},{value:"Flag Changes",id:"flag-changes",level:5},{value:"Flag Additions",id:"flag-additions",level:5}],u={toc:p},d="wrapper";function m(e){let{components:n,...t}=e;return(0,i.kt)(d,(0,a.Z)({},u,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("h1",{id:"upgrade-reference"},"Upgrade Reference"),(0,i.kt)("p",null,"This document provides a quick reference for the upgrades from ",(0,i.kt)("inlineCode",{parentName:"p"},"v0.50.x")," to ",(0,i.kt)("inlineCode",{parentName:"p"},"v0.53.x")," of Cosmos SDK."),(0,i.kt)("p",null,"Note, always read the ",(0,i.kt)("strong",{parentName:"p"},"App Wiring Changes")," section for more information on application wiring updates."),(0,i.kt)("p",null,"\ud83d\udea8Upgrading to v0.53.x will require a ",(0,i.kt)("strong",{parentName:"p"},"coordinated")," chain upgrade.\ud83d\udea8"),(0,i.kt)("h3",{id:"tldr"},"TLDR;"),(0,i.kt)("p",null,"Unordered transactions, ",(0,i.kt)("inlineCode",{parentName:"p"},"x/protocolpool"),", and ",(0,i.kt)("inlineCode",{parentName:"p"},"x/epoch")," are the major new features added in v0.53.x."),(0,i.kt)("p",null,"We also added the ability to add a ",(0,i.kt)("inlineCode",{parentName:"p"},"CheckTx")," handler and enabled ed25519 signature verification."),(0,i.kt)("p",null,"For a full list of changes, see the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/release/v0.53.x/CHANGELOG.md"},"Changelog"),"."),(0,i.kt)("h3",{id:"unordered-transactions"},"Unordered Transactions"),(0,i.kt)("p",null,"The Cosmos SDK now supports unordered transactions. ",(0,i.kt)("em",{parentName:"p"},"This is an opt-in feature"),"."),(0,i.kt)("p",null,"Clients that use this feature may now submit their transactions in a fire-and-forget manner to chains that enabled unordered transactions."),(0,i.kt)("p",null,"To submit an unordered transaction, clients must set the ",(0,i.kt)("inlineCode",{parentName:"p"},"unordered")," flag to\n",(0,i.kt)("inlineCode",{parentName:"p"},"true")," and ensure a reasonable ",(0,i.kt)("inlineCode",{parentName:"p"},"timeout_timestamp")," is set. The ",(0,i.kt)("inlineCode",{parentName:"p"},"timeout_timestamp")," is\nused as a TTL for the transaction and provides replay protection. Each transaction's ",(0,i.kt)("inlineCode",{parentName:"p"},"timeout_timestamp")," must be\nunique to the account; however, the difference may be as small as a nanosecond. See ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/main/docs/architecture/adr-070-unordered-transactions.md"},"ADR-070")," for more details."),(0,i.kt)("p",null,"Note that unordered transactions require sequence values to be zero, and will ",(0,i.kt)("strong",{parentName:"p"},"FAIL")," if a non-zero sequence value is set.\nPlease ensure no sequence value is set when submitting an unordered transaction.\nServices that rely on prior assumptions about sequence values should be updated to handle unordered transactions.\nServices should be aware that when the transaction is unordered, the transaction sequence will always be zero."),(0,i.kt)("h4",{id:"enabling-unordered-transactions"},"Enabling Unordered Transactions"),(0,i.kt)("p",null,"To enable unordered transactions, supply the ",(0,i.kt)("inlineCode",{parentName:"p"},"WithUnorderedTransactions")," option to the ",(0,i.kt)("inlineCode",{parentName:"p"},"x/auth")," keeper:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"    app.AccountKeeper = authkeeper.NewAccountKeeper(\n        appCodec,\n        runtime.NewKVStoreService(keys[authtypes.StoreKey]),\n        authtypes.ProtoBaseAccount,\n        maccPerms,\n        authcodec.NewBech32Codec(sdk.Bech32MainPrefix),\n        sdk.Bech32MainPrefix,\n        authtypes.NewModuleAddress(govtypes.ModuleName).String(),\n        authkeeper.WithUnorderedTransactions(true), // new option!\n    )\n")),(0,i.kt)("p",null,"If using dependency injection, update the auth module config."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},'        {\n            Name: authtypes.ModuleName,\n            Config: appconfig.WrapAny(&authmodulev1.Module{\n                Bech32Prefix:             "cosmos",\n                ModuleAccountPermissions: moduleAccPerms,\n                EnableUnorderedTransactions: true, // remove this line if you do not want unordered transactions.\n            }),\n        },\n')),(0,i.kt)("p",null,"By default, unordered transactions use a transaction timeout duration of 10 minutes and a default gas charge of 2240 gas units.\nTo modify these default values, pass in the corresponding options to the new ",(0,i.kt)("inlineCode",{parentName:"p"},"SigVerifyOptions")," field in ",(0,i.kt)("inlineCode",{parentName:"p"},"x/auth's")," ",(0,i.kt)("inlineCode",{parentName:"p"},"ante.HandlerOptions"),"."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"options := ante.HandlerOptions{\n    SigVerifyOptions: []ante.SigVerificationDecoratorOption{\n        // change below as needed.\n        ante.WithUnorderedTxGasCost(ante.DefaultUnorderedTxGasCost),\n        ante.WithMaxUnorderedTxTimeoutDuration(ante.DefaultMaxTimoutDuration),\n    },\n}\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"anteDecorators := []sdk.AnteDecorator{\n    // ... other decorators ...\n    ante.NewSigVerificationDecorator(options.AccountKeeper, options.SignModeHandler, options.SigVerifyOptions...), // supply new options\n}\n")),(0,i.kt)("h3",{id:"app-wiring-changes"},"App Wiring Changes"),(0,i.kt)("p",null,"In this section, we describe the required app wiring changes to run a v0.53.x Cosmos SDK application."),(0,i.kt)("p",null,(0,i.kt)("strong",{parentName:"p"},"These changes are directly applicable to your application wiring.")),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"x/auth")," module now contains a ",(0,i.kt)("inlineCode",{parentName:"p"},"PreBlocker")," that ",(0,i.kt)("em",{parentName:"p"},"must")," be set in the module manager's ",(0,i.kt)("inlineCode",{parentName:"p"},"SetOrderPreBlockers")," method."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"app.ModuleManager.SetOrderPreBlockers(\n    upgradetypes.ModuleName,\n    authtypes.ModuleName, // NEW\n)\n")),(0,i.kt)("p",null,"That's it."),(0,i.kt)("h3",{id:"new-modules"},"New Modules"),(0,i.kt)("p",null,"Below are some ",(0,i.kt)("strong",{parentName:"p"},"optional")," new modules you can include in your chain.\nTo see a full example of wiring these modules, please check out the ",(0,i.kt)("a",{parentName:"p",href:"https://github.com/cosmos/cosmos-sdk/blob/release/v0.53.x/simapp/app.go"},"SimApp"),"."),(0,i.kt)("h4",{id:"epochs"},"Epochs"),(0,i.kt)("p",null,"\u26a0\ufe0fAdding this module requires a ",(0,i.kt)("inlineCode",{parentName:"p"},"StoreUpgrade"),"\u26a0\ufe0f"),(0,i.kt)("p",null,"The new, supplemental ",(0,i.kt)("inlineCode",{parentName:"p"},"x/epochs")," module provides Cosmos SDK modules functionality to register and execute custom logic at fixed time-intervals."),(0,i.kt)("p",null,"Required wiring:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Keeper Instantiation"),(0,i.kt)("li",{parentName:"ul"},"StoreKey addition"),(0,i.kt)("li",{parentName:"ul"},"Hooks Registration "),(0,i.kt)("li",{parentName:"ul"},"App Module Registration"),(0,i.kt)("li",{parentName:"ul"},"entry in SetOrderBeginBlockers"),(0,i.kt)("li",{parentName:"ul"},"entry in SetGenesisModuleOrder"),(0,i.kt)("li",{parentName:"ul"},"entry in SetExportModuleOrder")),(0,i.kt)("h4",{id:"protocolpool"},"ProtocolPool"),(0,i.kt)("admonition",{type:"warning"},(0,i.kt)("p",{parentName:"admonition"},"Using ",(0,i.kt)("inlineCode",{parentName:"p"},"protocolpool")," will cause the following ",(0,i.kt)("inlineCode",{parentName:"p"},"x/distribution")," handlers to return an error:"),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"QueryService")),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"CommunityPool"))),(0,i.kt)("p",{parentName:"admonition"},(0,i.kt)("strong",{parentName:"p"},"MsgService")),(0,i.kt)("ul",{parentName:"admonition"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"CommunityPoolSpend")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"FundCommunityPool"))),(0,i.kt)("p",{parentName:"admonition"},"If you have services that rely on this functionality from ",(0,i.kt)("inlineCode",{parentName:"p"},"x/distribution"),", please update them to use the ",(0,i.kt)("inlineCode",{parentName:"p"},"x/protocolpool")," equivalents.")),(0,i.kt)("p",null,"\u26a0\ufe0fAdding this module requires a ",(0,i.kt)("inlineCode",{parentName:"p"},"StoreUpgrade"),"\u26a0\ufe0f"),(0,i.kt)("p",null,"The new, supplemental ",(0,i.kt)("inlineCode",{parentName:"p"},"x/protocolpool")," module provides extended functionality for managing and distributing block reward revenue."),(0,i.kt)("p",null,"Required wiring:"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"Module Account Permissions",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},"protocolpooltypes.ModuleName (nil)"),(0,i.kt)("li",{parentName:"ul"},"protocolpooltypes.ProtocolPoolEscrowAccount (nil)"))),(0,i.kt)("li",{parentName:"ul"},"Keeper Instantiation"),(0,i.kt)("li",{parentName:"ul"},"StoreKey addition"),(0,i.kt)("li",{parentName:"ul"},"Passing the keeper to the Distribution Keeper",(0,i.kt)("ul",{parentName:"li"},(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"distrkeeper.WithExternalCommunityPool(app.ProtocolPoolKeeper)")))),(0,i.kt)("li",{parentName:"ul"},"App Module Registration"),(0,i.kt)("li",{parentName:"ul"},"entry in SetOrderBeginBlockers"),(0,i.kt)("li",{parentName:"ul"},"entry in SetOrderEndBlockers"),(0,i.kt)("li",{parentName:"ul"},"entry in SetGenesisModuleOrder"),(0,i.kt)("li",{parentName:"ul"},"entry in SetExportModuleOrder ",(0,i.kt)("strong",{parentName:"li"},"before ",(0,i.kt)("inlineCode",{parentName:"strong"},"x/bank")))),(0,i.kt)("h2",{id:"custom-minting-function-in-xmint"},"Custom Minting Function in ",(0,i.kt)("inlineCode",{parentName:"h2"},"x/mint")),(0,i.kt)("p",null,"This release introduces the ability to configure a custom mint function in ",(0,i.kt)("inlineCode",{parentName:"p"},"x/mint"),". The minting logic is now abstracted as a ",(0,i.kt)("inlineCode",{parentName:"p"},"MintFn")," with a default implementation that can be overridden."),(0,i.kt)("h3",{id:"whats-new"},"What\u2019s New"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Configurable Mint Function:"),(0,i.kt)("br",{parentName:"p"}),"\n","A new ",(0,i.kt)("inlineCode",{parentName:"p"},"MintFn")," abstraction is introduced. By default, the module uses ",(0,i.kt)("inlineCode",{parentName:"p"},"DefaultMintFn"),", but you can supply your own implementation.")),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Deprecated InflationCalculationFn Parameter:"),(0,i.kt)("br",{parentName:"p"}),"\n","The ",(0,i.kt)("inlineCode",{parentName:"p"},"InflationCalculationFn")," argument previously provided to ",(0,i.kt)("inlineCode",{parentName:"p"},"mint.NewAppModule()")," is now ignored and must be ",(0,i.kt)("inlineCode",{parentName:"p"},"nil"),". To customize the default minter\u2019s inflation behavior, wrap your custom function with ",(0,i.kt)("inlineCode",{parentName:"p"},"mintkeeper.DefaultMintFn")," and pass it via the ",(0,i.kt)("inlineCode",{parentName:"p"},"WithMintFn")," option:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"  mintkeeper.WithMintFn(mintkeeper.DefaultMintFn(customInflationFn))\n")),(0,i.kt)("h3",{id:"how-to-upgrade"},"How to Upgrade"),(0,i.kt)("ol",null,(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Using the Default Minting Function")),(0,i.kt)("p",{parentName:"li"},"No action is needed if you\u2019re happy with the default behavior. Make sure your application wiring initializes the MintKeeper like this:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"   mintKeeper := mintkeeper.NewKeeper(\n       appCodec,\n       storeService,\n       stakingKeeper,\n       accountKeeper,\n       bankKeeper,\n       authtypes.FeeCollectorName,\n       authtypes.NewModuleAddress(govtypes.ModuleName).String(),\n   )\n")),(0,i.kt)("ol",{start:2},(0,i.kt)("li",{parentName:"ol"},(0,i.kt)("p",{parentName:"li"},(0,i.kt)("strong",{parentName:"p"},"Using a Custom Minting Function")),(0,i.kt)("p",{parentName:"li"},"To use a custom minting function, define it as follows and pass it you your mintKeeper when constructing it:"))),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-go"},"func myCustomMintFunc(ctx sdk.Context, k *mintkeeper.Keeper) {\n   // do minting...\n}\n\n// ...\n   mintKeeper := mintkeeper.NewKeeper(\n       appCodec,\n       storeService,\n       stakingKeeper,\n       accountKeeper,\n       bankKeeper,\n       authtypes.FeeCollectorName,\n       authtypes.NewModuleAddress(govtypes.ModuleName).String(),\n       mintkeeper.WithMintFn(myCustomMintFunc), // Use custom minting function\n   )\n")),(0,i.kt)("h3",{id:"misc-changes"},"Misc Changes"),(0,i.kt)("h4",{id:"testnets-init-files-command"},"Testnet's init-files Command"),(0,i.kt)("p",null,"Some changes were made to ",(0,i.kt)("inlineCode",{parentName:"p"},"testnet"),"'s ",(0,i.kt)("inlineCode",{parentName:"p"},"init-files")," command to support our new testing framework, ",(0,i.kt)("inlineCode",{parentName:"p"},"Systemtest"),"."),(0,i.kt)("h5",{id:"flag-changes"},"Flag Changes"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},"The flag for validator count was changed from ",(0,i.kt)("inlineCode",{parentName:"li"},"--v")," to ",(0,i.kt)("inlineCode",{parentName:"li"},"--validator-count"),"(shorthand: ",(0,i.kt)("inlineCode",{parentName:"li"},"-v"),").")),(0,i.kt)("h5",{id:"flag-additions"},"Flag Additions"),(0,i.kt)("ul",null,(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--staking-denom")," allows changing the default stake denom, ",(0,i.kt)("inlineCode",{parentName:"li"},"stake"),"."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--commit-timeout")," enables changing the commit timeout of the chain."),(0,i.kt)("li",{parentName:"ul"},(0,i.kt)("inlineCode",{parentName:"li"},"--single-host")," enables running a multi-node network on a single host. This bumps each subsequent node's network addresses by 1. For example, node1's gRPC address will be 9090, node2's 9091, etc...")))}m.isMDXComponent=!0}}]);